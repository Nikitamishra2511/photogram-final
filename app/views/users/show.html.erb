<h1><%= @user.username %>'s Profile</h1>

<p>Private: <%= @user.private? ? "Yes" : "No" %></p>

<% if user_signed_in? && current_user != @user %>
  <% fr = FollowRequest.find_by(sender: current_user, recipient: @user) %>

  <% if fr.nil? %>
    <%= button_to "Follow", follow_requests_path(recipient_id: @user.id), method: :post %>

  <% elsif fr.status == "pending" %>
    Request sent
    <%= button_to "Cancel", follow_request_path(fr), method: :delete %>

  <% elsif fr.status == "accepted" %>
    <%= button_to "Unfollow", follow_request_path(fr), method: :delete %>

  <% elsif fr.status == "rejected" %>
    Rejected
  <% end %>
<% end %>

<% if user_signed_in? && current_user == @user && @user.private? %>
  <h3>Pending Follow Requests</h3>
  <ul>
    <% @pending_requests.each do |request| %>
      <li>
        <%= request.sender.username %>
        <%= button_to "Accept", follow_request_path(request, status: "accepted"), method: :patch %>
        <%= button_to "Reject", follow_request_path(request, status: "rejected"), method: :patch %>
      </li>
    <% end %>
  </ul>
<% end %>

<h3>Stats</h3>
<ul>
  <li>Followers: <%= @user.received_follow_requests.where(status: "accepted").count %></li>
  <li>Following: <%= @user.sent_follow_requests.where(status: "accepted").count %></li>
  <li>Total Photos: <%= @photos.count %></li>
</ul>

<h3><%= @user.username %>'s Photos</h3>
<% @photos.each do |photo| %>
  <div>
    <%= image_tag photo.image if photo.image.attached? %>
    <p><%= photo.caption %></p>
    <p><strong>Likes:</strong> <%= photo.likes_count %></p>
    <p>Posted: <%= time_ago_in_words(photo.created_at) %> ago</p>
    <%= link_to "View", photo_path(photo) %>
  </div>
<% end %>

<hr>

<p>
  <%= link_to "Feed", user_feed_path(@user.username) %> |
  <%= link_to "Liked Photos", user_liked_photos_path(@user.username) %> |
  <%= link_to "Discover", user_discover_path(@user.username) %>
</p>
