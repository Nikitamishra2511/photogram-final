<h1><%= @the_user.username %>'s Profile</h1>
<p>Email: <%= @the_user.email %></p>
<p>Private: <%= @the_user.private ? "Yes" : "No" %></p>
<p>Comments count: <%= @the_user.comments.count %></p>
<p>Likes count: <%= @the_user.likes.count %></p>

<nav>
  <a href="/users/<%= @the_user.username %>/feed">Feed</a> |
  <a href="/users/<%= @the_user.username %>/liked_photos">Liked photos</a> |
  <a href="/users/<%= @the_user.username %>/discover">Discover</a>
</nav>

<%# ——— Add Follow/Unfollow here ——— %>
<% if user_signed_in? && current_user.id != @the_user.id %>
  <% fr = FollowRequest.where({
        :fan_id       => current_user.id,
        :recipient_id => @the_user.id
      }).at(0) %>

  <% if fr.nil? %>
    <form action="/follow_requests/create" method="post">
      <input type="hidden" name="fan_id"       value="<%= current_user.id %>" />
      <input type="hidden" name="recipient_id" value="<%= @the_user.id %>"   />
      <button>Follow</button>
    </form>
  <% elsif fr.status == "accepted" %>
    <a href="/delete_follow_request/<%= fr.id %>">Unfollow</a>
  <% end %>
<% end %>


<h2>Photos</h2>

<% @the_user.photos.each do |photo| %>
  <div class="user-photo">
    <a href="/photos/<%= photo.id %>">
      <img src="<%= photo.image.url %>" alt="Photo" />
    </a>

    <p>Caption: <%= photo.caption %></p>
    <p>Likes: <%= photo.likes.count %></p>
    <p>Posted <%= time_ago_in_words(photo.created_at) %> ago</p>

    <a href="/photos/<%= photo.id %>">Show details</a>
  </div>
<% end %>

<a href="/users">Back to Users</a>
