<h1>All Public Photos</h1>

<% if user_signed_in? %>
  <h2>Add a New Photo</h2>
  <%= form_with model: @new_photo, local: true, html: { multipart: true } do |form| %>
    <p>
      <%= form.label :image, "Upload an image" %><br>
      <%= form.file_field :image %>
    </p>

    <p>
      <%= form.label :caption, "Caption" %><br>
      <%= form.text_field :caption %>
    </p>

    <%= form.submit "Add photo" %>
  <% end %>
<% end %>

<hr>

<% @photos.each do |photo| %>
  <div style="margin-bottom: 30px; border-bottom: 1px solid #ccc; padding: 10px;">
    <% if photo.image.attached? %>
      <%= image_tag url_for(photo.image), alt: "Photo", style: "max-width: 100%; height: auto;" %>
    <% end %>

    <p><strong>Owner:</strong> <%= link_to photo.owner.username, user_profile_path(photo.owner.username) %></p>
    <p><strong>Caption:</strong> <%= photo.caption %></p>
    <p><strong>Posted:</strong> <%= time_ago_in_words(photo.created_at) %> ago</p>
    <p><strong>Likes:</strong> <%= photo.likes_count || photo.likes.count %></p>
    <p><%= pluralize(photo.comments.count, "comment") %></p>

    <% if user_signed_in? && photo.owner == current_user %>
      <%= link_to "Edit", edit_photo_path(photo) %> |
      <%= link_to "Delete this photo", photo_path(photo), method: :delete, data: { confirm: "Are you sure?" } %>
    <% end %>
  </div>
<% end %>
